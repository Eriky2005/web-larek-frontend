# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Карточка

```
export interface ICard {
    "id": string,
    "description"?: string,
    "image"?: string,
    "title": string,
    "category"?: string,
    "price": number | null;
}
```

Заказ

```
export interface IOrder {
    payment: string;
    address: string;
    email: string;
    phone: string;
    total: number;
    items: string[];
}
```

Модель для успешного оформления заказа

```
export interface IOrderResult {
    id: string;
    total: number;
}
```

Данные заказа, используемые в форме при выборе способа оплаты и адреса доставки

```
export type TOrderForm = Pick<IOrder, 'payment' | 'address'>;
```

Данные заказа, используемые в форме при указании почты и номера телефона

```
export type TContactsForm = Pick<IOrder, 'email' | 'phone'>;
```
Интерфейс заказа для отправки на сервер

```
export type TOrder = Omit<IOrder, 'items' | 'total'>
```

## Общая структура и архитектура проектной работы:
Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   


### Слой данных

#### Класс AppData
Класс отвечает за хранение и логику работы с данными карточек.\
Конструктор класса принимает инстант брокера событий\
В полях класса хранятся следующие данные:
- itemsBasket: Map<string,number> - корзина с товарами
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.
- _cards: ICard[] - массив объектов карточек
- _preview: string | null - id карточки, выбранной для просмотра в модальной окне
- order: TOrder - заказ для дальнейшей валидации

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addToBasket(id: string): void - добавляет одну карточку в корзину
- deleteToBasket(id: string, payload: Function | null ): void - удаляет карточку из корзины. Если передан колбэк, то выполняет его после удаления, если нет, то вызывает событие изменения массива.
- setCards(items: ICard[]): void - установка карточек после загрузки из апи 
- getCard(id: string): ICard - возвращает карточку по ее id
- clearBasket(): void - очистка корзины
- isInBasket(id: string): void - проверка на наличие карточки в корзине
- clearOrder(): void - очистка полей для заказа
- validateOrder(): void - валидация для способа оплаты и адреса доставки
- validateContacts(): void - валидация для почты и номера телефона
- getTotal - Метод для вычисления общей стоимости заказанных товаров.
- setOrderField(field: keyof TOrder, value: string): void - Метод для установки значения поля в заказе.
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Базовый Класс Component
Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

#### Класс Modal
Класс Modal предоставляет функциональность для создания и управления модальным окном. Он позволяет открывать и закрывать модальное окно, а также управлять его содержимым. Обработчики событий обеспечивают удобное взаимодействие с пользователем, позволяя закрывать модальное окно как по клику на кнопку, так и по клику вне его содержимого.

В полях класса хранятся следующие данные:
- protected _closeButton: HTMLButtonElement - Это свойство хранит ссылку на кнопку закрытия модального окна.
- protected _content: HTMLElement - Это свойство хранит ссылку на элемент, который будет содержать контент модального окна.
- constructor(container: HTMLElement, protected events: IEvents) - Конструктор принимает контейнер и экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия.
- set content(value: HTMLElement) - Сеттер для установки содержимого модального окна.
- open() - Метод для открытия модального окна.
- close() - Метод для закрытия модального окна.
- render(data: IModalData): HTMLElement - Метод для рендеринга модального окна.

#### Класс Form
Класс Form предоставляет функциональность для управления формами в веб-приложении.

В полях класса хранятся следующие данные:
- protected _submit: HTMLButtonElement - Это свойство хранит ссылку на кнопку отправки формы.
- protected _errors: HTMLElement - Это свойство хранит ссылку на элемент, который будет отображать ошибки валидации формы.
- constructor(protected container: HTMLFormElement, protected events: IEvents) - Конструктор принимает контейнер и экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия.
- protected onInputChange(field: keyof T, value: string)
- render(state: Partial<T> & IFormState) - Метод для рендеринга формы. Он принимает состояние формы, включая валидность и ошибки, и обновляет соответствующие свойства.
- а так-же сеттер для установки состояния валидности формы и сеттер для установки текста ошибок валидации

#### Класс Success 
Класс Success представляет собой компонент, который используется для отображения сообщения об успешном завершении отправки формы и завершения заказа.

В полях класса хранятся следующие данные:
- protected _close: HTMLElement - Это свойство хранит ссылку на элемент, который будет использоваться для закрытия сообщения об успехе.
- constructor(container: HTMLElement, actions: ISuccessActions) - в конструкторе есть: элемент, в котором будет размещен компонент и объект, содержащий действия, которые могут быть выполнены в ответ на события в компоненте.

#### Класс Order 
Класс Order экспортируется для использования в других модулях и наследуется от класса Form. Параметр типа <TOrder> указывает, что форма будет работать с данными, соответствующими типу TOrder.

- constructor(protected container: HTMLFormElement, protected events: IEvents) - Конструктор принимает контейнер и экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс предоставляет набор методов для взаимодействия.
- Сеттер для установки значения поля "payment", "address", "email", "phone"
- set payment(value: string): void;
- set address(value: string): void;
- set email(value: string): void;
- set phone(value: string): void;

#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, описания, цены, категории и кнопку. Класс используется для отображения карточек на странице сайта. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события. Также в классе есть сеттеры и геттеры для установки и получения значений. constructor(container: HTMLElement, actions?: ICardActions) - Конструктор принимает три параметра: 1. Элемент, в котором будет размещен компонент карточки. 2. Объект, содержащий действия, которые могут быть выполнены в ответ на события в карточке.

#### Класс Backet
Отвечает за отображение корзины.

В полях класса хранятся следующие данные:
- protected _list: HTMLElement;
- protected _total: HTMLElement;
- protected _button: HTMLElement;

Так же класс предоставляет набор методов для взаимодействия.
- set total(total: number): void - меняет значение суммы
- set items(items: HTMLElement[]): void - меняет содержимое корзины
- toggleButton(state: boolean): void - меняет активность кнопки 

#### Класс Page
Реализует главную страницу - каталог товаров с счетчиком. Имеет набор сеттеров, отвечающих за DOM-элементы главной страницы.

В полях класса хранятся следующие данные:
- protected _counter: HTMLElement - счётчик
- protected _catalog: HTMLElement - каталог с карточками
- protected _wrapper: HTMLElement - обертка на странице
- protected _basket: HTMLElement - корзина на странице

Так же класс предоставляет набор методов для взаимодействия.
- Сеттеры
- set counter(value: number) - меняет содержимое счётчика 
- set catalog(items: HTMLElement[]) - меняет содержимое каталога 
- set locked(value: boolean) - меняет класс обёртки

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
- getCardList: () => Promise<ICard[]> - выгрузка списка карточек
- getProduct: (id: string) => Promise<ICard> - выгрузка карточки
- createOrder: (order: IOrder) => Promise<IOrderResult> - отправка заказа на сервер

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `basket:changed` - изменение данных списка товаров корзины
- `cards:changed` - изменение массива карточек
- `preview:changed` - изменение открываемой в модальном окне картинки карточки
- `formErrors:changed` - необходима очистка данных выбранной для показа в модальном окне карточки

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `modal:open` - открытие модального окна
- `modal:close` - закрытие модального окна
- `basket:open` - открытие модального окна с корзиной
- `card:select` - выбор карточки для отображения в модальном окне
- `order:open` - открытие модального окна с формой для заказа
- `${form}:submit` - отправка формы с кастомным названием
- `${form}.${field}:change` - изменение поля с кастомным названием в форме с кастомным названием